#include <conio.h>
#include <cstdlib>
#include <fstream>
#include <string>
#include "Logic.h"

using namespace std;

HANDLE console = GetStdHandle(STD_OUTPUT_HANDLE); 
COORD CursorPosition; 

void gotoXY(int, int); 

int main()
{
	_setmode(_fileno(stdout), _O_U16TEXT);
	srand(time(0));

	
	ShowWindow(GetConsoleWindow(), SW_MAXIMIZE);
	SetConsoleTitle(L"Main Menu");
	system("color F0");

	vector<string> menu = { "Start", "Rules", "Exit" };

	int pointerMenuItem = 0;
	int pointerXMenuPosition = 20;

	int xMenuStartPosition = 20;
	int yMenuPosition = 100;

	int leftBracket = 98;
	int rightBracket = 106;


	gotoXY(leftBracket, 20); wcout << "[";
	gotoXY(rightBracket, 20); wcout << "]";


	while (true)
	{
		//======================================================================================================================================================================
		gotoXY(0, 0);
		wcout
			<< endl << endl << endl 
			<< "_____¶¶¶¶__________¶¶¶¶¶¶\n"
			<< "_____¶¶¶¶__________¶¶¶¶¶¶\n"
			<< "_¶¶¶¶¶¶¶¶¶¶¶¶____¶¶¶¶¶¶\n"
			<< "_____¶¶¶¶¶¶¶¶¶¶_¶¶¶¶¶\n"
			<< "___________¶¶¶¶¶¶¶¶\n"
			<< "____________¶¶¶¶¶¶\n"
			<< "_______________________________¶¶¶¶¶¶\n"
			<< "___________________________¶¶¶¶¶¶¶¶\n"
			<< "__________________________¶¶¶¶¶\n"
			<< "____________¶¶¶¶¶¶¶¶¶¶¶___¶¶¶¶¶¶¶¶\n"
			<< "_____________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_0_¶¶¶\n"
			<< "__________________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "___________¶¶¶__¶¶¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "_____________¶¶¶¶¶¶\n"
			<< "___________¶¶¶¶\n"
			<< "_______________\n"
			<< "________________¶¶¶¶¶¶_¶¶¶\n"
			<< "______________¶¶¶¶_¶¶¶¶¶¶¶\n"
			<< "_________¶¶¶_¶¶¶¶¶¶_____¶¶\n"
			<< "¶¶¶_¶¶¶¶¶¶¶__¶¶¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "¶¶¶¶¶¶¶__¶¶__¶_________¶¶¶\n"
			<< "¶¶¶¶¶¶¶¶¶¶¶_____________¶¶\n"
			<< "___¶¶¶___¶¶____________¶¶¶___¶¶¶¶\n"
			<< "__________¶¶___¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_____¶¶\n"
			<< "__¶¶¶¶¶¶¶¶___¶¶_¶¶________¶¶\n"
			<< "___¶¶_______¶¶_¶¶_________¶¶\n"
			<< "__¶¶________¶__¶__________¶¶\n"
			<< "__¶________¶¶_¶¶___________¶_____¶¶___¶¶\n"
			<< "__¶_________¶_¶¶___________¶¶____¶¶¶_¶¶¶\n"
			<< "__¶¶________¶¶¶¶___¶¶¶¶¶¶¶¶_¶¶___¶¶_¶¶_¶_¶¶¶\n"
			<< "__¶¶___¶¶¶¶__¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶__¶_¶¶\n"
			<< "___¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶___¶¶¶¶\n"
			<< "___¶¶¶¶¶¶¶¶¶¶¶¶¶¶__________¶¶¶__¶¶¶___¶¶¶¶\n"
			<< "___¶¶_________¶¶__________¶¶____¶¶____¶¶¶\n"
			<< "____¶_________¶¶__________¶¶__¶¶¶_____¶¶¶\n"
			<< "___¶¶¶¶_______¶¶¶_________¶¶_¶¶___¶¶¶¶¶¶¶¶\n"
			<< "___¶¶¶¶_______¶¶¶_________¶¶¶¶_¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "_____¶¶¶¶¶¶¶¶¶¶¶¶¶_¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶\n"
			<< "_____¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_¶_¶¶¶¶\n"
			<< "______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_¶¶_¶¶¶¶\n"
			<< "________¶¶_________¶_¶_____¶__¶¶¶¶¶¶¶¶¶\n"
			<< "_________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_¶¶¶\n"
			<< "__________¶¶¶__¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶___¶¶¶\n"
			<< "___________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶\n";

		string draw[48]
		{
			"_____________________§¶___________________________",
			"_____________________1¶_¶¶¶_______________________",
			"____________________¶¶¶¶1_________________________",
			"___________________¶_¶¶____11§1___________________",
			"_____________________¶§__¶¶¶¶¶¶¶¶¶¶_______________",
			"______________________¶¶¶11__¶¶¶§¶¶¶¶¶____________",
			"____________________¶¶¶¶__¶¶¶_§¶¶¶¶¶_¶¶___________",
			"___________________§¶¶1___1_¶¶__1¶1¶1_¶§__________",
			"___________________¶1_¶¶_____¶_1_1¶_¶_1¶__________",
			"____________________¶__1¶1____¶¶__¶1¶¶_§¶_________",
			"____________________¶1___¶¶____¶¶_1¶_¶¶1¶_________",
			"_____________________¶¶¶1__¶¶___¶__¶__¶¶¶1________",
			"_____________________¶_¶¶_1__¶__§__¶1__¶1¶________",
			"_____________________1___¶§___¶_1§__¶___¶¶________",
			"__________1__¶¶1__§__1§___¶§_¶¶11¶__¶___¶¶________",
			"__¶¶¶11¶¶_______¶¶___1____¶¶_¶1¶1§__¶___¶¶§_______",
			"¶¶§__§§__¶___________1§___1¶_¶_¶1____¶__§¶¶_______",
			"_§§______11__________1¶___1¶_¶_¶1____¶___¶¶_______",
			"_____________________1¶____¶_¶1¶1____¶___1¶_______",
			"1¶¶_______1¶1¶¶§¶_____¶____¶_¶1¶1____¶___1¶_______",
			"___¶¶¶¶¶_§¶_¶_________¶____¶_¶_¶§____¶____¶_______",
			"________§§__1_________¶____¶_¶¶1¶_________¶1______",
			"______________________¶____¶_¶¶_¶_________¶1______",
			"______________________¶____¶_¶¶_¶________1¶1______",
			"______________________¶___1¶_¶¶_¶________¶¶_______",
			"______________________¶___§1_¶§_¶________¶¶_______",
			"______________________¶___¶1§¶_§§________¶¶_______",
			"______________________¶___¶_¶¶_¶_________¶¶_______",
			"____¶¶¶¶¶¶¶¶__________¶___¶§¶_¶1________§¶¶_______",
			"____11¶_§§_¶¶¶________¶__¶¶¶¶1§_________¶¶¶_______",
			"_____¶_¶1¶_¶_¶________¶_1¶¶¶_¶_____1____¶¶1__¶____",
			"_____¶_¶_1_¶__§_______¶_¶¶¶_¶§__________¶¶__11§___",
			"_____¶¶¶¶¶¶¶¶¶¶¶______¶¶¶§__¶__________¶¶¶__¶§¶___",
			"_____§¶¶¶¶¶¶¶¶¶¶¶____1¶¶___¶__________1¶¶¶__¶¶¶___",
			"______¶¶¶¶¶§¶¶¶¶¶____¶¶___¶__________¶¶¶¶§__¶¶¶___",
			"______¶¶¶¶¶¶¶¶¶¶¶____¶___1¶________1¶¶¶¶¶___¶¶1___",
			"______¶¶1¶¶¶¶¶¶¶¶____¶__§¶§________¶¶§§¶___1¶¶____",
			"______¶§1¶¶¶¶¶¶§¶____¶__§1___1_§¶¶¶¶¶¶¶¶___¶§¶____",
			"______¶¶¶¶¶¶¶¶¶¶¶____¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶§____¶¶¶¶____",
			"_______¶¶¶¶¶¶¶¶1¶¶___§¶¶¶¶¶¶¶¶¶¶¶¶______¶¶¶§¶¶____",
			"_______¶¶¶¶¶¶¶¶¶§¶1__¶¶¶¶¶_¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶1§1____",
			"_______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶§§§§_¶¶1____",
			"_______§¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_¶¶_¶_____",
			"_______1¶¶1¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶11¶¶¶¶¶¶¶¶§1_¶1_____",
			"_______1¶§¶¶¶¶¶¶1§§¶¶§1___¶¶¶¶¶¶¶§1_§____¶¶1______",
			"________¶¶¶¶§¶¶¶¶¶1¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶________",
			"_________1§¶¶¶¶§__________________________________",
			"__________________________________________________"
		};

		for (int i = 0; i < 48; i++)
		{
			gotoXY(159, 1 + i);
			wcout << draw[i].c_str();
		}

		//======================================================================================================================================================================


		for (int i = 0; i < menu.size(); i++)
		{
			gotoXY(yMenuPosition, xMenuStartPosition + i); wcout << menu[i].c_str();
		}

		system("pause>nul");

		if (GetAsyncKeyState(VK_DOWN) && pointerXMenuPosition != xMenuStartPosition -1 ) //down button pressed
		{
			gotoXY(leftBracket, pointerXMenuPosition); wcout << " ";
			gotoXY(rightBracket, pointerXMenuPosition); wcout << " ";
			pointerXMenuPosition++;
			if (pointerXMenuPosition == xMenuStartPosition + menu.size())
			{
				pointerXMenuPosition = xMenuStartPosition;
				pointerMenuItem = 0;
			}
			else
			{
				pointerMenuItem++;
			}
			gotoXY(leftBracket, pointerXMenuPosition); wcout << "[";
			gotoXY(rightBracket, pointerXMenuPosition); wcout << "]";
			continue;

		}

		if (GetAsyncKeyState(VK_UP) && pointerXMenuPosition != xMenuStartPosition -1) //up button pressed
		{
			gotoXY(leftBracket, pointerXMenuPosition); wcout << " ";
			gotoXY(rightBracket, pointerXMenuPosition); wcout << " ";
			pointerXMenuPosition--;
			if (pointerXMenuPosition == xMenuStartPosition - 1)
			{
				pointerXMenuPosition = xMenuStartPosition + menu.size() - 1;
				pointerMenuItem = 2;
			}
			else
			{
				pointerMenuItem--;
			}
			gotoXY(leftBracket, pointerXMenuPosition); wcout << "[";
			gotoXY(rightBracket, pointerXMenuPosition); wcout << "]";
			continue;
		}

		if (GetAsyncKeyState(VK_RETURN)) { // Enter key pressed

			switch (pointerMenuItem) {

			case 0: 
			{
				system("cls");
				system("color F9");
				SetConsoleTitle(L"Sea buttle");

				Player player;
				Player enemy;

				enemy.AutoFieldFilling();
				player.ManualFieldFilling(enemy);

				do
				{
					
					player.PrintField(40, 1, PrintPlayerField);
					enemy.PrintField(130, 1, PrintEnemyField);
					wcout << "\n\n\t\t\t\t\t\tYour turn, SHOOOT!!!    \n";
					Sleep(2000);
					player.ManualShooting(enemy);

					player.PrintField(40, 1, PrintPlayerField);
					enemy.PrintField(130, 1, PrintEnemyField);
					wcout << "\n\n\t\t\t\t\t\tBots turn, be careful!   \n";
					Sleep(2000);
					enemy.AutoShooting(player);
					

				} while (player.getHealPoints() != 0 && enemy.getHealPoints() != 0);

				if (player.getHealPoints() == 0)
				{
					wcout << "\t\t\t\t\t\tYou lose\nMaybe next time?\n";
				}
				else if (enemy.getHealPoints() == 0)
				{
					wcout << "\t\t\t\t\t\tCongratulations, you WIN!\n";
				}
				else
				{
					wcout << "\t\t\t\t\t\tIt's a draw\nSometimes happes\n";
				}
				system("pause");
				system("cls");
				SetConsoleTitle(L"Main Menu");
				system("color F0");
				break;
			}
			case 1: 
			{
				system("cls");
				system("color F2");
				SetConsoleTitle(L"Rules");


				char buf;
				ifstream fin("Rules.txt");
				if (fin.is_open())
				{
					while (fin.get(buf))
					{
						wcout << buf;
					}
				}
				else
				{
					wcout << "\tOpen file Error\n";
				}
				//===================================================================================
				string draw[29]
				{
					"___________________¶¶¶8¶¶_________________________",
					"_____________¶¶¶¶¶¶¶¶¶¶¶¶_________________________",
					"_____________¶¶¶¶8¶¶¶¶¶¶¶_________________________",
					"______________________¶¶__________________________",
					"_____________________¶8¶_¶8¶______________________",
					"_____________________¶8¶_¶888¶____________________",
					"_____________________¶8¶__8¶¶8¶¶__________________",
					"__________________¶¶_¶8¶__¶88¶¶8¶_________________",
					"__________________¶8¶¶8¶___¶8888¶¶________________",
					"_________________¶8¶¶¶¶¶___¶888¶88¶¶______________",
					"_______________¶88¶¶¶¶8¶____¶8¶88¶¶¶¶_____________",
					"______________¶¶8¶¶¶¶¶¶¶____¶8¶¶¶¶¶¶¶¶____________",
					"_____________¶88888¶_¶¶¶____¶88¶8¶¶888¶¶__________",
					"____________¶8888¶8¶_¶¶¶____¶88888¶¶8888¶_________",
					"___________¶888¶888¶_¶8¶____¶8¶¶88¶888¶88¶________",
					"__________¶8¶888888¶_¶8¶____¶8¶88¶8888$888¶_______",
					"_________¶88¶¶88888¶_¶8¶____¶88¶88¶¶¶¶888¶8¶______",
					"_______¶8888¶¶888¶¶¶_¶8¶_____8888¶8¶¶8888¶¶8¶_____",
					"______¶88888¶8¶¶¶¶8¶_¶8¶____¶¶888¶¶¶88¶8¶888¶_____",
					"____¶¶888¶¶¶8¶8¶¶88¶_¶¶¶____¶88888888¶8¶88888_____",
					"__¶¶88¶88888888888¶¶_¶8¶___¶88888888¶88¶88¶88_____",
					"_¶8¶¶¶¶¶¶_¶¶¶88888¶¶_¶8¶___88¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶_____",
					"¶¶____________¶¶¶8¶¶_¶¶¶__¶88¶¶____________¶¶__¶¶_",
					"888¶¶¶¶¶________¶¶8¶_¶¶¶__¶¶¶___________¶¶¶¶¶¶¶8¶¶",
					"_¶¶¶888¶¶88¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶_¶¶¶¶¶¶¶¶888¶¶¶¶___",
					"____¶¶8¶¶8888888¶888888888$8888¶8888888888¶_______",
					"_____¶¶8888¶¶8888888888¶888¶¶88¶¶88¶88888¶________",
					"________¶¶¶¶¶¶888¶¶¶88888¶8888888¶8¶¶¶¶¶__________",
					"______________888¶¶¶¶88¶¶8¶8¶¶¶8¶¶________________"
				};
				
				for (int i = 0; i < 29; i++)
				{
					gotoXY(155, 0 + i);
					wcout << draw[i].c_str();
				}
				//===================================================================================
				wcout << endl << endl << endl << endl << endl;
				system("pause");
				fin.close();

				system("cls");
				SetConsoleTitle(L"Main Menu");
				system("color F0");
				break;
			}
			case 2: 
			{
				return 0;
			}
			}
		}
	}
}

void gotoXY(int x, int y)
{
	CursorPosition.X = x;
	CursorPosition.Y = y;
	SetConsoleCursorPosition(console, CursorPosition);
}